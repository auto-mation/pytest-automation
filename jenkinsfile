
pipeline {
 	agent {
        label 'qa-regression-sm'
    }
    parameters {
            choice(name: 'BROWSER', choices: ['chrome', 'firefox', 'safari'], description: 'Targeted browser for GUI tests')
        }
    stages {
        stage('Preparation') {
            steps { 
                 sh('''  
                    chmod +x ./setup.sh
                    ./setup.sh 
                    source ./myenv/bin/activate
                ''')
            }
        }
        stage('Automation Scripts') {
            parallel {
                stage('API Automation') {
                    steps { 
                        sh 'python ./runner.py -m api'
                    }
                }
                stage('GUI Automation') {
                    steps { 
                        sh 'python ./runner.py -m gui --browser=${params.BROWSER}'
                    }
                }
            }
        }
    }
    post {
        always {
            archiveArtifacts artifacts: '**/target/*.log', fingerprint: true

            cleanWs()
        }
        failure {
            emailext (
                subject: "Jenkins Pipeline Failure: ${env.JOB_NAME}",
                body: "The pipeline '${env.JOB_NAME}' has failed. Please check the build logs at ${env.BUILD_URL}.",
                to: 'your-email@example.com'
            )
    }
}
}